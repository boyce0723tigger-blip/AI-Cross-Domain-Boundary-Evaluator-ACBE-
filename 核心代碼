import json
import matplotlib.pyplot as plt
import numpy as np
from mpl_toolkits.mplot3d import Axes3D

class AICrossDomainEvaluator:
    def __init__(self, json_file):
        try:
            with open(json_file, 'r', encoding='utf-8') as f:
                self.data = json.load(f)
        except Exception as e:
            print(f"Error loading JSON: {e}")
            self.data = {}

    def plot_3d_risk_map(self):
        if not self.data:
            return

        fig = plt.figure(figsize=(12, 9))
        ax = fig.add_subplot(111, projection='3d')

        for model_name, tests in self.data.items():
            x = [float(t["dimensions"]["domain_similarity"]) for t in tests]
            y = [float(t["dimensions"]["risk_level"]) for t in tests]
            z = [float(t["dimensions"]["fracture_intensity"]) for t in tests]
            names = [t["case_name"] for t in tests]

            scatter = ax.scatter(x, y, z, c=z, s=[val*30 for val in z],
                                 cmap='Reds', alpha=0.8, edgecolors='w', label=model_name)
            for i, txt in enumerate(names):
                ax.text(x[i], y[i], z[i] + 0.5, txt, size=9, weight='bold')

        ax.set_xlabel('Domain Similarity (X)')
        ax.set_ylabel('Decision Risk Level (Y)')
        ax.set_zlabel('Fracture Intensity (Z)')
        ax.set_zlim(0, 11)
        
        plt.title("ACBE: AI Cross-Domain Risk Mapping", pad=20, fontsize=15)
        plt.colorbar(scatter, label='Fracture Intensity', shrink=0.5, aspect=10)
        ax.view_init(elev=20, azim=135)
        plt.tight_layout()
        plt.show()

if __name__ == "__main__":
    evaluator = AICrossDomainEvaluator("../data/tests_gemini_3.json")
    evaluator.plot_3d_risk_map()
